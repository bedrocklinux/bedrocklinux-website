<!doctype html>
<html lang=en>
<meta charset=utf-8>
<title>Bedrock Linux 1.0alpha1 Appa Client Setup Instructions</title>
<meta name=viewport content="width=device-width">
<link rel=alternate type=application/atom+xml title="Bedrock Linux Feed" href=./..//atom.xml>
<link rel=stylesheet href=./..//bedrock.css><body>
<header>
<h1 id=logo><a href=./..//><pre>__          __             __
\ \_________\ \____________\ \___
 \  _ \  _\ _  \  _\ __ \ __\   /
  \___/\__/\__/ \_\ \___/\__/\_\_\</pre>
</a></h1>
<ul id=nav>
<li><a href="../index.html">Home</a></li>
</ul>

<p>Bedrock Linux 1.0alpha1 Appa</p>

<ul id=nav>
<li><a href="index.html">Root Appa page</a></li>
<li><a href="systemrequirements.html">System Requirements</a></li>
<li><a href="knownissues.html">Known issues</a></li>
<li><a href="install.html">Installation instructions</a></li>
<li><a href="clients.html">Client setup instructions</a></li>
<li><a href="configure.html">Configuration instructions</a></li>
<li><a href="commands.html">Command overview</a></li>
</ul>

</header>
<section>
		<div id=main>

			<h1 id="Appa Client Setup Instructions">Appa  Client Setup Instructions</h1>
			<p>
				These are instructions client Linux distributions.  They cover both general
				information as well as information specific to individual Linux distributions.
			</p>

			<!-- table of contents -->

			<ol>
				<li><a href="#Any Linux Distribution">Any Linux Distribution</a></li>
				<ol>
					<li><a href="#ANY Installation">Installation</a></li>
					<li><a href="#ANY Tweaks and Configuration">Tweaks and Configuration</a></li>
				</ol>
				<li><a href="#Debian-based Linux distributions">Debian-based Linux distributions</a></li>
				<ol>
					<li><a href="#DEBIAN Installation">Installation</a></li>
					<li><a href="#DEBIAN Tweaks and Configuration">Tweaks and Configuration</a></li>
					<li><a href="#DEBIAN Troubleshooting">Troubleshooting</a></li>
				</ol>
				<li><a href="#Arch Linux">Arch Linux</a></li>
				<ol>
					<li><a href="#ARCH Installation">Installation</a></li>
					<li><a href="#ARCH Known issues">Known issues</a></li>
					<li><a href="#ARCH Troubleshooting">Troubleshooting</a></li>
				</ol>
				<li><a href="#Fedora">Fedora</a></li>
				<ol>
					<li><a href="#FEDORA Installation">Installation</a></li>
					<li><a href="#FEDORA Troubleshooting">Troubleshooting</a></li>
				</ol>
			</ol>

			<!-- actual main content -->
			<h2 id="Any Linux Distribution">Any Linux Distribution</h2>
			<h3 id="ANY Installation">Installation</h3>
			<p>
				If there are no instructions below specific to a Linux
				distribution which you would like to make into a client for
				your Bedrock Linux install, you can usually fall back to simply
				installing the distribution through its normal installation
				means.  Once it is installed, you may simply copy its root
				directory to where you would like the client to reside within
				Bedrock.  When installing the Linux distribution by its normal
				means, be very careful when partitioning, and be careful to
				avoid having the bootloader take over your system.
			</p>
			<p>
				For example, if you install Slackware to a USB flash drive, you
				can mount the USB flash drive in Bedrock Linux and copy its
				contents to <code>/var/chroot/slackware</code>.
			</p>
			<p>
				However, this method requires rebooting as well as provides the
				possibility of unintentionally wiping something important when
				partitioning or forcing you to reinstall your bootloader, and
				thus the distro-specific instructions described below may be
				preferable if available.
			</p>
			<h3 id="ANY Tweaks and Configuration">Tweaks and Configuration</h3>
			<p>
				Sudo PATH:
			</p>
			<p>
				It may be advisable to look at the PATH generated by
				<code>/etc/profile</code> for root and set it as
				<code>/etc/sudoer</code>'s <code>secure_path</code>.
			</p>
			<p>
				Users/Groups when package managing:
			</p>
			<p>
				Due to a known issue with Bedrock, the usual means for adding
				users and groups does not from work in clients.  Many packages
				in the repositories of clients may attempt to add users or
				groups.  Apt/dpkg is known to abort if it cannot add a group,
				and pacman is known to continue without aborting despite the
				issue.  If this happens, you can attempt to add the
				users/groups from wihtin core Bedrock Linux or manually edit
				the files with your text editor of choice (from the core or
				within a client, either is fine).  You can then re-run the
				package manager command.
			</p>
			<p>
				Proprietary Nvidia Drivers:
			</p>
			<p>
				For the Nvidia proprietary driver to work, you should ensure
				the directory containing the kernel modules (historically
				<code>/lib/modules</code>, although there is a push to move it
				to <code>/usr/lib/modules</code>) is either shared or copied
				into at least the client(s) which run X11/xinit/startx.
				Moreover, you should ensure nouveau is not enabled.  Bedrock
				currently does not have any system in place to manage kernel
				module loading.  If you compiled your kernel with nouveau, you
				can simple (re)move the module.  To find it, run
			</p>
			<pre class="cmd">find /lib/modules -name nouveau</pre>
			</p>
				and move or delete the file (as root).
			</p>
			<p>
				The proprietary Nvidia driver should be compiled using the same
				version of the same compiler used to compile the kernel.  If
				you compiled the kernel in the installer host, you can make a
				Bedrock Linux client from the installer host and use that to
				compile the nvidia driver.  Otherwise, you can recompile the
				Linux kernel using a client (and install it and reboot) and
				then use that client again to compile the nvidia driver.
			</p>
			<h2 id="Debian-based Linux distributions">Debian-based Linux distributions</h2>
			<h3 id="DEBIAN Installation">Installation</h3>
			<p>
				The essentials of Debian-based Linux distributions can be
				installed through a program called "debootstrap."  Debootstrap
				is a shell script which can be easily installed into almost
				every Debian-based Linux distribution, and is often available
				in the repositories of non-Debian-based Linux distributions,
				such as Fedora.  While it is possible to install debootstrap
				(by first installing dpkg and pkgdetails) into just about any
				other Linux distribution as well, it is not covered here.
				Busybox's dpkg does not seem sufficient for debootstrap.
			</p>
			<p>
				Instructions:
			</p>
			<ol>
				<li>
					<p>
						Boot into a Linux distribution which can run
						debootstrap, or use a client which can use debootstrap
						in Bedrock Linux if available.  LiveCD/LiveUSBs such as
						Knoppix or an Ubuntu installer should work.
					</p>
				</li>
				<li>
					<p>
						Ensure the pre-requisites for debootstrap are
						available.  This can be done by installing debootstrap
						through the distribution's package manager, if
						available.  Next, download the .deb file for the
						debootstrap specific to client Linux distribution
						release you would like, or a newer debootstrap .deb
						from the same distribution.  For example, for Debian
						Squeeze, grab the file made available from <a
						href="http://packages.debian.org/squeeze/debootstrap">here</a>.
						If you are attempting to use debootstrap from a
						non-debian-based Linux distribution, convert the .deb
						file to the native package format with something such
						as the <code>alien</code> package.
					</p>
				</li>
				<li>
					<p>
						Install the package.  If on a debian-based system (as
						root):
					</p>
				<pre class="rcmd">dpkg -i debootstrap_<VERSION>.deb</pre>
				</li>
				<li>
					<p>
						Make a directory in which to put the target client Linux
						distribution.
					</p>
					<pre class="rcmd">mkdir <code class="changethis">PATH</code></pre>
				</li>
				<li>
					<p>
						Use debootstrap to download and set up the target
						client Linux distribution.
					</p>
					<pre class="rcmd">debootstrap --arch <code class="changethis">ARCHITECTURE</code><code class="changethis">RELEASE</code> <code class=changethis>PATH</code> <code class="changethis">REPOSITORY/MIRROR</code></pre>
					<p>
						For example, to install the (64-bit) x86_64 Debian squeeze to
						<code>/var/chroot/squeeze</code> using <code>http://ftp.us.debian.org/debian</code>:
					</p>
					<pre class="rcmd">debootstrap --arch amd64 squeeze /var/chroot/squeeze http://ftp.us.debian.org/debian</pre>
				<p>
					It may take a bit to download and unpackage the various
					components.
				</p>
				<li>
					<p>
						Don't forget to edit <code>/etc/apt/sources.list</code> and
						other client-specific settings.
					</p>
				</li>
			</ol>
			<h3 id="DEBIAN Tweaks and Configuration">Tweaks and Configuration</h3>
			<p>
				Ubuntu/Upstart fix:
			</p>
			<p>
				Ubuntu uses Upstart for its init system.  Many services in
				Ubuntu have been modified to depend on init to be specific to
				Upstart and refuse to operate otherwise.  This means they do
				not work in chroots out of the box.  See the <a
					href="https://bugs.launchpad.net/ubuntu/+source/upstart/+bug/430224">here
				</a> for more information.  One way to alleviate this is to run
				the following two commands as root (within the Ubuntu client,
				via using <code>brc</code> for each command or <code>brc</code>
				to open a shell in the client and run it from the shell):
			</p>
				<ul class="rcmd">
					<li>dpkg-divert --local --rename --add /sbin/initctl</li>
					<li>ln -s /bin/true /sbin/initctl</li>
				</ul>
			<p>
				Locales:
			</p>
			<p>
				In Debian, if you get errors about locale, try installing the
				<code>locales-all</code> package.
			</p>
			<p>
				In Ubuntu, if you get errors about locale, try installing the appropriate
				<code>language-pack-*</code> (such as </code>language-pack-en</code>) package.
			</p>
			<h3 id="DEBIAN Troubleshooting">Troubleshooting</h3>
			<p>
			If you get an error about <code>statoverride</code> when using
			<code>apt/dpkg</code>, it can most likely be resolved by deleting
			the contents of <code>/var/lib/dpkg/statoverride</code> (from
			within the client - ie, <code><code
					class=changethis>/path/to/chroot</code>/var/lib/dpkg/statoverride</code>
			from outside).  Leave an empty file there.  This seems to occur due
			to the fact an expected daemon is not running.
			</p>
			<h2 id="Arch Linux">Arch Linux</h2>
			<h3 id="ARCH Installation">Installation</h3>
			<p>
				Arch Linux's package manager, <code>pacman</code>, can be used
				to setup a new Arch Linux install in a folder in a manner
				similar to Debian's <code>debootstrap</code>.  It is possible
				to setup <code>pacman</code> and its requirements in a folder
				and then use it through chroot, largely independent of the host
				Linux environment.  From there, it can be used to setup a new
				Arch Linux client for Bedrock Linux.  This should work from a
				client Linux distribution for Bedrock Linux or from a
				LiveCD/LiveUSB.  Whether this works from the core of Bedrock
				Linux remains untested.
			</p>
			<p>
				Instructions:
			</p>
			<ol>
				<li>
					<p>
						Create and move into a temporary working directory:
					</p>
					<ul class="cmd">
						<li>mkdir /tmp/archbootstrap</li>
						<li>cd /tmp/archbootstrap</li>
					</ul>
				</li>
				<li>
					<p>
						Download and the required software.
					</p>
					<ul class="cmd">
						<li>ARCH=<code class=changethis>ARCH</code> # Set to either "x86_64" to "i686"</li>
						<li>wget https://www.archlinux.org/packages/core/any/pacman-mirrorlist/download --trust-server-names</li>
						<li>for PACKAGE in pacman glibc gcc-libs binutils libssh2 curl gcc libarchive openssl xz expat gpgme zlib libassuan libgpg-error acl attr bzip2</li>
						<li>do</li>
						<li>wget https://www.archlinux.org/packages/core/$ARCH/$PACKAGE/download/ --trust-server-names</li>
						<li>done</li>
					</ul>
				</li>
				<li>
					<p>
						Unpackage all packages
					</p>
					<ul class="cmd">
						<li>for PACKAGE in *.pkg.tar*</li>
						<li>do</li>
						<li>tar xvf $PACKAGE</li>
						<li>done</li>
					</ul>
				</li>
				<li>
					<p>
						Uncomment a mirror in
						<code>/tmp/archbootstrap/etc/pacman.d/mirrorlist</code>
						to use to download Arch Linux.
					</p>
				</li>
				<li>
					<p>
						Disable signiture verification.  Open
						<code>/tmp/archbootstrap/etc/pacman.conf</code>, find
						the line containing <code>SigLevel</code> under
						<code>[core]</code> and change the value to
						<code>Never</code>.  Note that this is only for the
						initial download of Arch Linux - it can continue to use
						signiture verification like normal once installed as a
						Bedrock Linux client.
					</p>
				</li>
				<li>
					<p>
						Copy <code>/etc/resolv.conf</code> into the
						archbootstrap environment so it can resolve DNS.
					</p>
					<pre class="cmd">cp /etc/resolv.conf /tmp/archbootstrap/etc/</pre>
				</li>
				<li>
					<p>
						Update the archboostrap we've set up, just in case
					</p>
					<pre class="cmd">chroot /tmp/archbootstrap pacman -Syu</pre>
				</li>
				<li>
					<p>
						Create a new directory in which to download and install
						the Arch Linux client.  Note that this has to be within
						<code>/tmp/archbootstrap</code>.  You can later move
						the contents to where you prefer, or you can make a
						bind mount so everything installed into this new
						directory actually goes where you want it to.
						Moreover, ensure it includes the location for pacman's
						databases within it.
					</p>
					<pre class="cmd">mkdir -p /tmp/archbootstrap/arch/var/lib/pacman/local</pre>
				</li>
				<li>
					<p>
						Have pacman download its database information into the new directory.  Note
						that we are stripping off <code>/tmp/archbootstrap</code> because this is being run in a
						chroot.
					</p>
					<pre class="rcmd">chroot /tmp/archbootstrap pacman -Sy -r /arch</pre>
				</li>
				<li>
					<p>
						By default, pacman checks if enough free space is
						available before unpackaging things.  However, the
						chroot and heavily-used bindmount environment seem to
						confuse it.  Comment out <code>CheckSpace</code> from
						<code>/tmp/archbootstrap/etc/pacman.conf</code>
					</p>
				</li>
				<li>
					<p>
						Install Arch Linux's base:
					</p>
					<pre class="rcmd">chroot /tmp/archbootstrap pacman -Su base -r /arch</pre>
					<p>
						It may take a bit to download and unpackage the various components.
					</p>
				</li>
				<li>
					<p>
						If you did not bind-mount
						<code>/tmp/archbootstrap/arch</code>, move
						<code>/tmp/archbootstrap/arch</code> to where you would
						like the Arch client to reside.  Otherwise, unmount it
						so it is no longer accessible within
						<code>/tmp/archbootstrap</code>.
					</p>
					<pre class="rcmd">mv /tmp/archbootstrap/arch <code class=changethis>PATH</code></pre>
				</li>
				<li>
					<p>
						Clean up the temporary archbootstrap directory:
					</p>
					<pre class="rcmd">rm -rf /tmp/archbootstrap</pre>
				</li>
			</ol>
			<h3 id="ARCH Known issues">Known issues</h3>
			<p>
				<code>/lib</code> symlink:
			</p>
			<p>
				Arch Linux symlinks <code>/lib</code> to <code>/usr/lib</code>.
				If you would like to share (some of the) contents of
				<code>/lib</code> across clients (for example, if you would
				like to share <code>/lib/modules</code>), the symlink can cause
				issues with how Bedrock Linux manages sharing directories.
			</p>
			<p>
				For the time being, it is recommended that you simply avoid
				using bind mounts to attempt to share such directories.  Simply
				copy the contents across manually when required.
			</p>
			<h3 id="ARCH Troubleshooting">Troubleshooting</h3>
			<p>
				Pacman filesystem errors:
			</p>
			<p>
				If you get errors about "could not get filesystem information
				for <code class="changethis">PATH</code>" when using pacman,
				this is normal and mostly harmless so long as you have
				sufficient free disk space for the operation you are
				attempting.  This seems to be caused by pacman assuming that
				the mount points it sees are the same as the ones init sees
				(which would be a fair assumption in almost every case except
				Bedrock Linux).  You can configure pacman to not check for free
				disk space by commenting out <code>CheckSpace</code> from
				<code><code
				class="changethis">/path/to/chroot</code>/etc/pacman.conf</code>
			</p>
			<p>
				/dev/fd errors:
			</p>
			<p>
				If you receive errors along these lines:
			</p>
			<code>/dev/fd/<code class="changethis">N</code>: No such file or directory</code>
			<p>
				where <code class="changethis">N</code> is a number, this is
				most likely due to the fact that the device manager you are
				using is not setting up /dev/fd as some Arch programs expect.
				This can be solved (for the current session) by running:
			</p>
			<ul class="rcmd">
				<li>rm -r /dev/fd</li>
				<li>ln -s /proc/self/fd /dev</li>
			</ul>
			<p>
				To solve this permanently, one could simply add those two lines
				to <code>/etc/rc.local</code> in the core Bedrock such that it
				is run every time Bedrock Linux is booted.
			</p>
			<h2 id="Fedora">Fedora</h2>
			<h3 id="FEDORA Installation">Installation</h3>
			<p>
				The essentials of Fedora can be installed through the 2.X
				branch of a program called "febootstrap".  Febootstrap is very
				similar in spirit to debootstrap, simply intended for creating
				Fedora systems rather than Debian.  Note that a 3.X branch was
				created which is intended to create "supermin appliances"; use
				the 2.X branch instead.  This may be difficult to find in the
				repositories of any given Linux distribution, and thus it may
				be required to compile it from source.
			</p>
			<p>
				Instructions:
			</p>
			<ol>
				<li>
					<p>
						If you have access to a Linux distribution which has
						febootstrap 2.X in its repositories, your you can find
						a febootstrap 2.X package which will work in a
						distribution to which you have access, install it and
						run the following command, at which point you will be
						done installing Fedora as a client (ie, you can skip
						the rest of the steps below).  Otherwise, you will have
						to skip this step and following all of the following
						steps.
					</p>
					<pre class="rcmd">febootstrap fedora-<code class="changethis">RELEASE-NUMBER</code><code class="changethis">PATH</code></pre>
					<p>
						For example, to install Fedora 17 (beefy miracle) to /var/chroot/beefy:
					</p>
					<pre class="rcmd">febootstrap fedora-17 /var/chroot/beefy/</pre>
					<p>
						It may take a bit to download and unpackage the various
						components.
					</p>
				</li>
				<li>
					<p>
						Boot or brc into a Linux distribution which will be
						used to compile febootstrap and then later use
						febootstrap.  Note that while most of the requirements
						for febootstrap are fairly standard, it does require
						yum, which is in many but not all of the major Linux
						distribution's repositories - chosing one of the
						distributions which do will make things easier.
					</p>
				</li>
				<li>
					<p>
						Download the latest febootstrap 2.X source from <a
						href="http://people.redhat.com/~rjones/febootstrap/">here</a> to <code>/tmp</code>.
					</p>
				</li>
				<li>
					<p>
						Untar the package.
						<ul class="cmd">
							<li>cd /tmp</li>
							<li>tar xvf febootstrap-<code class="changethis">VERSION</code>.tar.gz</li>
						</ul>
					</p>
				</li>
				<li>
					<p>
						Configure things.  You may be warned you are missing
						requirements - install them and try again.
						<ul class="cmd">
							<li>cd /tmp/febootstrap-<code class="changethis">VERSION</code></li>
							<li>./configure</li>
						</ul>
					</p>
				</li>
				<li>
					<p>
						Compile febootstrap.  <pre class="cmd">make</pre> If
						you receive an error about <code>-all-static</code>,
						note that at least one person who had such an error
						reported some succes compiling febootstrap by
						commenting out the line containing <code>init_LDFLAGS =
						-all-static</code> from <code>/tmp/febootstrap-<code
						class="changethis">VERSION</code>/helper/Makefile</code>
						and replacing it with <code>init_LDFLAGS =
						-static</code>.
					</p>
				</li>
				<li>
					<p>
						There is no need to properly install febootstrap, as it
						will run from <code>/tmp/febootstrap-<code
						class="changethis">VERSION</code></code> just fine.
						However, it does depend on executables which are found
						within <code>/tmp/febootstrap<code
						class="changethis">VERSION</code></code>  to be present
						within the <code>PATH</code>.  Use febootstrap to
						download and set up the target client Linux
						distribution.
					</p>
					<pre class="rcmd">PATH="$PATH:/tmp/febootstrap-<code class="changethis">VERSION</code>" ./febootstrap fedora-<code class="changethis">RELEASE-NUMBER</code><code class="changethis">PATH</code></pre>
					<p>
						For example, to install Fedora 17 (beefy miracle) to /var/chroot/beefy:
					</p>
					<pre class="rcmd">PATH="$PATH:/tmp/febootstrap-<code class="changethis">VERSION</code>" ./febootstrap fedora-17 /var/chroot/beefy/</pre>
					<p>
						It may take a bit to download and unpackage the various
						components.
					</p>
				</li>
				<li>
					<p>
						Clean up the temporary febootstrap directory:
					</p>
					<pre class="rcmd">rm -rf /tmp/febootstrap-<code class=changethis">VERSION</code></pre>
				</li>
			</ol>
			<h3 id="FEDORA Troubleshooting">Troubleshooting</h3>
			<p>
				Febootstrap does not seem to always include the fedora-release
				package.  This is troublesome, as the package utilized to
				access the Fedora repositories.  If you find difficulties using
				yum, you might be able to respolve this by downloading the
				fedora-release package for the given release (e.g.:
				<code>fedora-release-17.noarch.rpm</code>), and install it
				thusly (from within the fedora client, via brc):
			</p>
			<pre class="rcmd">rpm -i fedora-<code class="changethis">VERSION</code>.noarch.rpm</pre>
			<p>
				You should then be able to use <code>yum</code> to access
				Fedora's repositories as one normally would.
			</p>
		</div>

</section>
<footer>
<p>Â© <a href=/>Bedrock Linux</a> 2012-2013
</footer>
</html>
